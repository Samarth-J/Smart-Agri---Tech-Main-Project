<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <title>Crop Recommendation</title>
  <link rel="icon" type="image/png" href="/AgriTech/images/logo.png">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <link rel="stylesheet" href="/Crop Recommendation/static/style.css" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="../../theme.css" />
  <style>
    * {
      box-sizing: border-box;
      transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease;
    }

    body {
      font-family: "Poppins", sans-serif;
      background-color: var(--bg-secondary, #d4fc79);
      color: var(--text-primary, #333);
      background-size: 400% 400%;
      animation: gradientShift 8s ease infinite;
      margin: 0;
      padding: 20px;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
    }

    @keyframes gradientShift {
      0% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }

      100% {
        background-position: 0% 50%;
      }
    }

    .container {
      background: var(--bg-primary, rgba(255, 255, 255, 0.95));
      backdrop-filter: blur(10px);
      padding: 50px 40px;
      border-radius: 24px;
      box-shadow: 0 20px 40px var(--shadow-medium, rgba(0, 0, 0, 0.1)),
        0 10px 20px var(--shadow-light, rgba(0, 0, 0, 0.05)),
        inset 0 1px 0 rgba(255, 255, 255, 0.8);
      text-align: center;
      max-width: 700px;
      width: 100%;
      position: relative;
      overflow: hidden;
      transform: translateY(0);
      animation: slideIn 0.8s ease-out;
      color: var(--text-primary, #333);
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateY(30px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .container::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg,
          transparent,
          rgba(255, 255, 255, 0.3),
          transparent);
      animation: shimmer 3s infinite;
    }

    @keyframes shimmer {
      0% {
        left: -100%;
      }

      100% {
        left: 100%;
      }
    }

    h1 {
      margin-bottom: 40px;
      color: var(--primary-green, #2e7d32);
      font-size: 32px;
      font-weight: 700;
      text-shadow: 0 2px 4px rgba(46, 125, 50, 0.1);
      position: relative;
      z-index: 1;
    }

    .form-grid {
      display: grid;
      gap: 20px;
      margin-bottom: 30px;
    }

    .input-group {
      position: relative;
    }

    .input-group input {
      width: 100%;
      padding: 16px 20px;
      border: 2px solid #e8f5e8;
      border-radius: 12px;
      font-size: 16px;
      font-family: inherit;
      background: var(--bg-primary, rgba(255, 255, 255, 0.9));
      color: var(--text-primary, #333);
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      outline: none;
    }

    .input-group input:focus {
      border-color: #66bb6a;
      background: var(--bg-primary, #ffffff);
      box-shadow: 0 0 0 3px rgba(102, 187, 106, 0.1),
        0 4px 12px rgba(102, 187, 106, 0.15);
      transform: translateY(-2px);
    }

    .input-group input:valid {
      border-color: #4caf50;
    }

    .input-group input::placeholder {
      color: var(--text-muted, #81c784);
      font-weight: 500;
    }

    .input-icon {
      position: absolute;
      right: 16px;
      top: 50%;
      transform: translateY(-50%);
      color: #66bb6a;
      font-size: 18px;
      pointer-events: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .input-group input:focus+.input-icon,
    .input-group input:valid+.input-icon {
      opacity: 1;
    }

    .submit-btn {
      width: 100%;
      padding: 18px 24px;
      background: linear-gradient(135deg, #2e7d32, #388e3c);
      color: white;
      font-weight: 600;
      font-size: 18px;
      cursor: pointer;
      border: none;
      border-radius: 12px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      text-transform: uppercase;
      letter-spacing: 0.5px;
    }

    .submit-btn:hover {
      background: linear-gradient(135deg, #1b5e20, #2e7d32);
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(46, 125, 50, 0.3),
        0 5px 15px rgba(46, 125, 50, 0.2);
    }

    .submit-btn:active {
      transform: translateY(-1px);
    }

    .submit-btn::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent);
      transition: left 0.6s;
    }

    .submit-btn:hover::before {
      left: 100%;
    }

    .back-btn {
      width: 100%;
      padding: 18px 24px;
      background: linear-gradient(135deg, #fb8c1d, #fca728);
      color: white;
      font-weight: 600;
      font-size: 18px;
      cursor: pointer;
      border: none;
      border-radius: 12px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      margin-top: 15px;
      text-decoration: none;
      display: inline-block;
    }

    .back-btn:hover {
      background: linear-gradient(135deg, #e65100, #f57c00);
      transform: translateY(-3px);
      box-shadow: 0 10px 25px rgba(245, 124, 0, 0.3),
        0 5px 15px rgba(245, 124, 0, 0.2);
    }

    .back-btn:active {
      transform: translateY(-1px);
    }

    .back-btn::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg,
          transparent,
          rgba(255, 255, 255, 0.2),
          transparent);
      transition: left 0.6s;
    }

    .back-btn:hover::before {
      left: 100%;
    }

    .features {
      display: flex;
      justify-content: space-around;
      margin-top: 30px;
      padding-top: 25px;
      border-top: 1px solid rgba(46, 125, 50, 0.1);
    }

    .feature {
      text-align: center;
      opacity: 0.8;
    }

    .feature-icon {
      font-size: 24px;
      margin-bottom: 8px;
      display: block;
    }

    .feature-text {
      font-size: 12px;
      color: #2e7d32;
      font-weight: 500;
    }

    @media (max-width: 768px) {
      body {
        padding: 10px;
      }

      .container {
        padding: 40px 30px;
        margin: 10px;
      }

      h1 {
        font-size: 28px;
        margin-bottom: 30px;
      }

      .features {
        flex-direction: column;
        gap: 15px;
      }

      .feature {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 10px;
      }

      .feature-icon {
        margin-bottom: 0;
      }
    }

    /* Loading animation */
    .loading {
      pointer-events: none;
      opacity: 0.7;
    }

    .loading .submit-btn::after {
      content: "";
      position: absolute;
      width: 20px;
      height: 20px;
      border: 2px solid transparent;
      border-top: 2px solid white;
      border-radius: 50%;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: translateY(-50%) rotate(0deg);
      }

      100% {
        transform: translateY(-50%) rotate(360deg);
      }
    }

    /* Dark mode specific styles for result display */
    [data-theme="dark"] .crop-result {
      --result-bg: rgba(30, 30, 30, 0.95);
      --result-border: rgba(102, 187, 106, 0.4);
      --result-text: #e8f5e9;
    }

    /* Tooltip styles */
    .tooltip {
      position: relative;
      display: inline-block;
    }

    .tooltip::after {
      content: attr(data-tooltip);
      position: absolute;
      bottom: 125%;
      left: 50%;
      transform: translateX(-50%);
      background-color: #333;
      color: white;
      padding: 8px 12px;
      border-radius: 6px;
      font-size: 12px;
      white-space: nowrap;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s;
      z-index: 1000;
    }

    .tooltip:hover::after {
      opacity: 1;
    }
  </style>
</head>

<body>
  <header></header>
  <div class="container">
    <div style="position: absolute; top: 20px; right: 20px;">
      <button class="theme-toggle" aria-label="Toggle dark/light mode"
        style="background: rgba(46, 125, 50, 0.1); border: 1px solid rgba(46, 125, 50, 0.3); color: #2e7d32; padding: 8px 12px; border-radius: 20px; font-size: 12px;">
        <i class="fas fa-sun sun-icon"></i>
        <i class="fas fa-moon moon-icon"></i>
        <span class="theme-text">Light</span>
      </button>
    </div>

    <h1>ü§ñ AI-Powered Crop Recommendation</h1>

    <!-- Tab Navigation -->
    <div style="display: flex; gap: 10px; margin-bottom: 30px; justify-content: center;">
      <button id="recommendTab" class="tab-btn active"
        style="flex: 1; padding: 12px 20px; border: 2px solid var(--primary-green, #2e7d32); background: var(--primary-green, #2e7d32); color: white; border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
        üåæ Find Best Crop
      </button>
      <button id="requirementsTab" class="tab-btn"
        style="flex: 1; padding: 12px 20px; border: 2px solid var(--primary-green, #2e7d32); background: transparent; color: var(--primary-green, #2e7d32); border-radius: 8px; cursor: pointer; font-weight: 600; transition: all 0.3s;">
        üìã Crop Requirements
      </button>
    </div>

    <!-- Recommendation Form (Default) -->
    <div id="recommendSection">
      <form id="cropForm">
        <div class="form-grid">
          <div class="input-group tooltip" data-tooltip="Nitrogen content in soil (0-140 kg/ha)">
            <input type="number" name="N" id="N" placeholder="Nitrogen (N)" required min="0" max="140" />
            <span class="input-icon">üß™</span>
          </div>

          <div class="input-group tooltip" data-tooltip="Phosphorus content in soil (5-145 kg/ha)">
            <input type="number" name="P" id="P" placeholder="Phosphorus (P)" required min="5" max="145" />
            <span class="input-icon">‚öóÔ∏è</span>
          </div>

          <div class="input-group tooltip" data-tooltip="Potassium content in soil (5-205 kg/ha)">
            <input type="number" name="K" id="K" placeholder="Potassium (K)" required min="5" max="205" />
            <span class="input-icon">üî¨</span>
          </div>

          <div class="input-group tooltip" data-tooltip="Average temperature (8-45¬∞C)">
            <input type="number" name="temperature" id="temperature" placeholder="Temperature (¬∞C)" step="0.1" required
              min="8" max="45" />
            <span class="input-icon">üå°Ô∏è</span>
          </div>

          <div class="input-group tooltip" data-tooltip="Relative humidity (14-100%)">
            <input type="number" name="humidity" id="humidity" placeholder="Humidity (%)" step="0.1" required min="14"
              max="100" />
            <span class="input-icon">üíß</span>
          </div>

          <div class="input-group tooltip" data-tooltip="Soil pH level (3.5-10.0)">
            <input type="number" name="ph" id="ph" placeholder="pH" step="0.01" required min="3.5" max="10" />
            <span class="input-icon">üìä</span>
          </div>

          <div class="input-group tooltip" data-tooltip="Annual rainfall (20-300mm)">
            <input type="number" name="rainfall" id="rainfall" placeholder="Rainfall (mm)" step="0.1" required min="20"
              max="300" />
            <span class="input-icon">üåßÔ∏è</span>
          </div>
        </div>

        <button type="submit" class="submit-btn">üåø Predict Crop</button>
      </form>
    </div>

    <!-- Requirements Section (Hidden by default) -->
    <div id="requirementsSection" style="display: none;">
      <form id="requirementsForm">
        <div class="input-group" style="margin-bottom: 20px;">
          <input type="text" id="cropNameInput" placeholder="Enter crop name (e.g., Rice, Wheat, Tomato)" required
            style="width: 100%; padding: 16px 20px; border: 2px solid #e8f5e8; border-radius: 12px; font-size: 16px; font-family: inherit; background: var(--bg-primary, rgba(255, 255, 255, 0.9)); color: var(--text-primary, #333); transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1); outline: none;"
            list="cropSuggestions" />
          <datalist id="cropSuggestions">
            <option value="Rice">
            <option value="Wheat">
            <option value="Maize">
            <option value="Cotton">
            <option value="Sugarcane">
            <option value="Tomato">
            <option value="Potato">
            <option value="Onion">
            <option value="Banana">
            <option value="Mango">
            <option value="Grapes">
            <option value="Carrot">
            <option value="Broccoli">
            <option value="Cabbage">
            <option value="Cauliflower">
            <option value="Chilli">
            <option value="Cucumber">
            <option value="Pumpkin">
            <option value="Watermelon">
          </datalist>
          <span class="input-icon"
            style="position: absolute; right: 16px; top: 50%; transform: translateY(-50%); color: #66bb6a; font-size: 18px;">üåæ</span>
        </div>
        <button type="submit" class="submit-btn">üìã Get Requirements</button>
      </form>
    </div>

    <a href="javascript:history.back()" class="back-btn">üîô Back to Main</a>

    <div class="features">
      <div class="feature">
        <span class="feature-icon">ü§ñ</span>
        <span class="feature-text">AI-Powered</span>
      </div>
      <div class="feature">
        <span class="feature-icon">‚ö°</span>
        <span class="feature-text">Llama3 Model</span>
      </div>
      <div class="feature">
        <span class="feature-icon">üå±</span>
        <span class="feature-text">Smart Analysis</span>
      </div>
    </div>
  </div>

  <script>
    // Form submission animation
    document
      .getElementById("cropForm")
      .addEventListener("submit", async function (e) {
        e.preventDefault();

        const container = document.querySelector(".container");
        const submitBtn = document.querySelector(".submit-btn");

        container.classList.add("loading");
        submitBtn.innerHTML = "ü§ñ AI Analyzing...";

        try {
          // Get form values
          const formData = new FormData();
          formData.append('N', document.getElementById('N').value);
          formData.append('P', document.getElementById('P').value);
          formData.append('K', document.getElementById('K').value);
          formData.append('temperature', document.getElementById('temperature').value);
          formData.append('humidity', document.getElementById('humidity').value);
          formData.append('ph', document.getElementById('ph').value);
          formData.append('rainfall', document.getElementById('rainfall').value);

          console.log('Sending data:', Object.fromEntries(formData));

          const response = await fetch('http://127.0.0.1:5000/predict', {
            method: 'POST',
            body: formData
          });

          console.log('Response status:', response.status);
          const result = await response.json();
          console.log('Response data:', result);

          if (result.status === 'success') {
            // Create enhanced AI-powered result display
            const tipsHtml = result.tips && result.tips.length > 0
              ? result.tips.map(tip => `<li style="text-align: left; margin-bottom: 8px; color: var(--text-primary, #1b5e20);">‚úì ${tip}</li>`).join('')
              : '<li style="text-align: left; color: var(--text-primary, #1b5e20);">Follow standard agricultural practices</li>';

            const resultDiv = document.createElement('div');
            resultDiv.innerHTML = `
                <div style="background: linear-gradient(135deg, rgba(46, 125, 50, 0.15), rgba(76, 175, 80, 0.15)); padding: 25px; border-radius: 16px; margin-top: 25px; text-align: center; animation: slideIn 0.5s ease-out; box-shadow: 0 8px 20px rgba(46, 125, 50, 0.2); border: 2px solid rgba(46, 125, 50, 0.3);">
                  <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 15px;">
                    <span style="font-size: 28px;">ü§ñ</span>
                    <h3 style="color: var(--primary-green, #2e7d32); margin: 0;">AI-Powered Recommendation</h3>
                  </div>
                  
                  <div style="background: linear-gradient(135deg, #66bb6a, #4caf50); padding: 25px; border-radius: 12px; margin: 20px 0; box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);">
                    <div style="font-size: 16px; color: rgba(255,255,255,0.95); margin-bottom: 8px; font-weight: 500;">Recommended Crop</div>
                    <div style="font-size: 32px; font-weight: bold; color: white; text-transform: capitalize; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                      üåæ ${result.crop}
                    </div>
                    ${result.yield_potential ? `
                      <div style="margin-top: 12px; padding: 8px 16px; background: rgba(255,255,255,0.25); border-radius: 20px; display: inline-block; font-size: 14px; color: white; font-weight: 600;">
                        üìä Yield Potential: ${result.yield_potential}
                      </div>
                    ` : ''}
                  </div>
                  
                  ${result.reason ? `
                    <div style="background: var(--bg-primary, rgba(255,255,255,0.9)); padding: 18px; border-radius: 10px; margin: 15px 0; text-align: left; border: 1px solid rgba(46, 125, 50, 0.2);">
                      <div style="font-weight: 600; color: var(--primary-green, #2e7d32); margin-bottom: 8px; display: flex; align-items: center; gap: 8px;">
                        <span>üí°</span> Why This Crop?
                      </div>
                      <div style="color: var(--text-primary, #1b5e20); line-height: 1.6; font-size: 14px;">
                        ${result.reason}
                      </div>
                    </div>
                  ` : ''}
                  
                  ${result.tips && result.tips.length > 0 ? `
                    <div style="background: var(--bg-primary, rgba(255,255,255,0.9)); padding: 18px; border-radius: 10px; margin: 15px 0; text-align: left; border: 1px solid rgba(46, 125, 50, 0.2);">
                      <div style="font-weight: 600; color: var(--primary-green, #2e7d32); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                        <span>üå±</span> Growing Tips
                      </div>
                      <ul style="color: var(--text-primary, #1b5e20); line-height: 1.8; font-size: 14px; margin: 0; padding-left: 20px; list-style: none;">
                        ${tipsHtml}
                      </ul>
                    </div>
                  ` : ''}
                  
                  <div style="margin-top: 20px; padding: 15px; background: var(--bg-primary, rgba(255,255,255,0.7)); border-radius: 8px; font-size: 12px; color: var(--text-primary, #1b5e20); border: 1px solid rgba(46, 125, 50, 0.2);">
                    <div style="font-weight: 600; margin-bottom: 8px; color: var(--primary-green, #2e7d32);">üìã Input Parameters</div>
                    <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 8px; text-align: left;">
                      <div>N: ${result.input_params.N} kg/ha</div>
                      <div>P: ${result.input_params.P} kg/ha</div>
                      <div>K: ${result.input_params.K} kg/ha</div>
                      <div>Temp: ${result.input_params.temperature}¬∞C</div>
                      <div>Humidity: ${result.input_params.humidity}%</div>
                      <div>pH: ${result.input_params.ph}</div>
                      <div style="grid-column: span 2;">Rainfall: ${result.input_params.rainfall}mm</div>
                    </div>
                  </div>
                  
                  <div style="margin-top: 15px; font-size: 11px; color: #66bb6a; font-style: italic;">
                    ‚ö° Powered by ${result.model || 'Llama3 AI'}
                  </div>
                </div>
              `;

            // Remove any existing result
            const existingResult = document.querySelector('.crop-result');
            if (existingResult) {
              existingResult.remove();
            }

            // Add the result after the form
            resultDiv.className = 'crop-result';
            document.querySelector('.container').appendChild(resultDiv);

            // Scroll to result
            setTimeout(() => {
              resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
            }, 100);
          } else {
            alert('Error: ' + (result.message || 'Unknown error occurred'));
          }
        } catch (error) {
          console.error('Error:', error);
          alert('An error occurred while processing your request. Please check the console for details.');
        } finally {
          container.classList.remove("loading");
          submitBtn.innerHTML = "üåø Predict Crop";
        }
      });

    // Input validation feedback
    const inputs = document.querySelectorAll('input[type="number"]');
    inputs.forEach((input) => {
      input.addEventListener("input", function () {
        const min = parseFloat(this.min);
        const max = parseFloat(this.max);
        const value = parseFloat(this.value);

        if (value < min || value > max) {
          this.style.borderColor = "#f44336";
          this.style.boxShadow = "0 0 0 3px rgba(244, 67, 54, 0.1)";
        } else if (this.value) {
          this.style.borderColor = "#4caf50";
          this.style.boxShadow = "0 0 0 3px rgba(76, 175, 80, 0.1)";
        }
      });
    });

    // Focus effects
    inputs.forEach((input) => {
      input.addEventListener("focus", function () {
        this.parentElement.style.transform = "translateY(-2px)";
      });

      input.addEventListener("blur", function () {
        this.parentElement.style.transform = "translateY(0)";
      });
    });
  </script>

  <script>
    // Tab switching functionality
    const recommendTab = document.getElementById('recommendTab');
    const requirementsTab = document.getElementById('requirementsTab');
    const recommendSection = document.getElementById('recommendSection');
    const requirementsSection = document.getElementById('requirementsSection');

    console.log('Tab elements:', { recommendTab, requirementsTab, recommendSection, requirementsSection });

    recommendTab.addEventListener('click', () => {
      console.log('Recommend tab clicked');
      recommendTab.classList.add('active');
      requirementsTab.classList.remove('active');
      recommendTab.style.background = 'var(--primary-green, #2e7d32)';
      recommendTab.style.color = 'white';
      requirementsTab.style.background = 'transparent';
      requirementsTab.style.color = 'var(--primary-green, #2e7d32)';
      recommendSection.style.display = 'block';
      requirementsSection.style.display = 'none';

      // Remove any existing results
      const existingResult = document.querySelector('.crop-result');
      if (existingResult) existingResult.remove();
    });

    requirementsTab.addEventListener('click', () => {
      console.log('Requirements tab clicked');
      requirementsTab.classList.add('active');
      recommendTab.classList.remove('active');
      requirementsTab.style.background = 'var(--primary-green, #2e7d32)';
      requirementsTab.style.color = 'white';
      recommendTab.style.background = 'transparent';
      recommendTab.style.color = 'var(--primary-green, #2e7d32)';
      requirementsSection.style.display = 'block';
      recommendSection.style.display = 'none';

      // Remove any existing results
      const existingResult = document.querySelector('.crop-result');
      if (existingResult) existingResult.remove();
    });

    // Requirements form submission
    document.getElementById('requirementsForm').addEventListener('submit', async function (e) {
      e.preventDefault();

      const container = document.querySelector('.container');
      const submitBtn = this.querySelector('.submit-btn');
      const cropName = document.getElementById('cropNameInput').value.trim();

      console.log('Requirements form submitted for crop:', cropName);

      if (!cropName) {
        alert('Please enter a crop name');
        return;
      }

      container.classList.add('loading');
      submitBtn.innerHTML = 'ü§ñ AI Analyzing...';

      try {
        console.log('Sending request to /crop-requirements...');

        const response = await fetch('http://127.0.0.1:5000/crop-requirements', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ crop_name: cropName })
        });

        console.log('Response status:', response.status);
        const result = await response.json();
        console.log('Requirements result:', result);

        if (result.status === 'success') {
          console.log('Parsed data:', {
            soil: result.soil_requirements,
            climate: result.climate_requirements,
            tips: result.growing_tips,
            harvest: result.harvest_info
          });

          // Show loading message if using AI
          if (result.source === 'ai') {
            submitBtn.innerHTML = 'ü§ñ AI Generating... (may take 30-60s)';
          }

          const soilHtml = result.soil_requirements && result.soil_requirements.length > 0
            ? result.soil_requirements.map(req => `<li style="text-align: left; margin-bottom: 8px; color: var(--text-primary, #1b5e20);">‚Ä¢ ${req}</li>`).join('')
            : '<li style="text-align: left; color: var(--text-primary, #1b5e20);">No specific requirements available</li>';

          const climateHtml = result.climate_requirements && result.climate_requirements.length > 0
            ? result.climate_requirements.map(req => `<li style="text-align: left; margin-bottom: 8px; color: var(--text-primary, #1b5e20);">‚Ä¢ ${req}</li>`).join('')
            : '<li style="text-align: left; color: var(--text-primary, #1b5e20);">No specific requirements available</li>';

          const tipsHtml = result.growing_tips && result.growing_tips.length > 0
            ? result.growing_tips.map(tip => `<li style="text-align: left; margin-bottom: 8px; color: var(--text-primary, #1b5e20);">‚úì ${tip}</li>`).join('')
            : '<li style="text-align: left; color: var(--text-primary, #1b5e20);">Follow standard agricultural practices</li>';

          const harvestHtml = result.harvest_info && result.harvest_info.length > 0
            ? result.harvest_info.map(info => `<li style="text-align: left; margin-bottom: 8px; color: var(--text-primary, #1b5e20);">üìÖ ${info}</li>`).join('')
            : '<li style="text-align: left; color: var(--text-primary, #1b5e20);">Standard harvest timing applies</li>';

          const resultDiv = document.createElement('div');
          resultDiv.innerHTML = `
            <div style="background: linear-gradient(135deg, rgba(46, 125, 50, 0.15), rgba(76, 175, 80, 0.15)); padding: 25px; border-radius: 16px; margin-top: 25px; text-align: center; animation: slideIn 0.5s ease-out; box-shadow: 0 8px 20px rgba(46, 125, 50, 0.2); border: 2px solid rgba(46, 125, 50, 0.3);">
              <div style="display: flex; align-items: center; justify-content: center; gap: 10px; margin-bottom: 15px;">
                <span style="font-size: 28px;">üìã</span>
                <h3 style="color: var(--primary-green, #2e7d32); margin: 0;">Growing Requirements</h3>
              </div>
              
              ${result.source === 'ai' ? `
                <div style="background: rgba(255, 193, 7, 0.2); padding: 10px; border-radius: 8px; margin-bottom: 15px; border: 1px solid rgba(255, 193, 7, 0.5);">
                  <span style="font-size: 14px; color: var(--text-primary, #333);">
                    ü§ñ AI Generated - This crop is not in our knowledge base yet
                  </span>
                </div>
              ` : `
                <div style="background: rgba(76, 175, 80, 0.2); padding: 10px; border-radius: 8px; margin-bottom: 15px; border: 1px solid rgba(76, 175, 80, 0.5);">
                  <span style="font-size: 14px; color: var(--text-primary, #333);">
                    ‚ö° Instant Result from Knowledge Base
                  </span>
                </div>
              `}
              
              <div style="background: linear-gradient(135deg, #66bb6a, #4caf50); padding: 20px; border-radius: 12px; margin: 20px 0; box-shadow: 0 4px 12px rgba(46, 125, 50, 0.3);">
                <div style="font-size: 32px; font-weight: bold; color: white; text-transform: capitalize; text-shadow: 0 2px 4px rgba(0,0,0,0.2);">
                  üåæ ${result.crop}
                </div>
              </div>
              
              <div style="background: var(--bg-primary, rgba(255,255,255,0.9)); padding: 18px; border-radius: 10px; margin: 15px 0; text-align: left; border: 1px solid rgba(46, 125, 50, 0.2);">
                <div style="font-weight: 600; color: var(--primary-green, #2e7d32); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                  <span>üå±</span> Soil Requirements
                </div>
                <ul style="color: var(--text-primary, #1b5e20); line-height: 1.8; font-size: 14px; margin: 0; padding-left: 20px; list-style: none;">
                  ${soilHtml}
                </ul>
              </div>
              
              <div style="background: var(--bg-primary, rgba(255,255,255,0.9)); padding: 18px; border-radius: 10px; margin: 15px 0; text-align: left; border: 1px solid rgba(46, 125, 50, 0.2);">
                <div style="font-weight: 600; color: var(--primary-green, #2e7d32); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                  <span>üå§Ô∏è</span> Climate Requirements
                </div>
                <ul style="color: var(--text-primary, #1b5e20); line-height: 1.8; font-size: 14px; margin: 0; padding-left: 20px; list-style: none;">
                  ${climateHtml}
                </ul>
              </div>
              
              <div style="background: var(--bg-primary, rgba(255,255,255,0.9)); padding: 18px; border-radius: 10px; margin: 15px 0; text-align: left; border: 1px solid rgba(46, 125, 50, 0.2);">
                <div style="font-weight: 600; color: var(--primary-green, #2e7d32); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                  <span>üí°</span> Growing Tips
                </div>
                <ul style="color: var(--text-primary, #1b5e20); line-height: 1.8; font-size: 14px; margin: 0; padding-left: 20px; list-style: none;">
                  ${tipsHtml}
                </ul>
              </div>
              
              <div style="background: var(--bg-primary, rgba(255,255,255,0.9)); padding: 18px; border-radius: 10px; margin: 15px 0; text-align: left; border: 1px solid rgba(46, 125, 50, 0.2);">
                <div style="font-weight: 600; color: var(--primary-green, #2e7d32); margin-bottom: 12px; display: flex; align-items: center; gap: 8px;">
                  <span>üåæ</span> Harvest Information
                </div>
                <ul style="color: var(--text-primary, #1b5e20); line-height: 1.8; font-size: 14px; margin: 0; padding-left: 20px; list-style: none;">
                  ${harvestHtml}
                </ul>
              </div>
              
              <div style="margin-top: 15px; font-size: 11px; color: #66bb6a; font-style: italic;">
                ‚ö° Powered by ${result.model || 'Llama3 AI'}
              </div>
            </div>
          `;

          // Remove any existing result
          const existingResult = document.querySelector('.crop-result');
          if (existingResult) existingResult.remove();

          // Add the result
          resultDiv.className = 'crop-result';
          container.appendChild(resultDiv);

          // Scroll to result
          setTimeout(() => {
            resultDiv.scrollIntoView({ behavior: 'smooth', block: 'nearest' });
          }, 100);
        } else {
          alert('Error: ' + (result.message || 'Unknown error occurred'));
        }
      } catch (error) {
        console.error('Error:', error);
        alert('An error occurred while processing your request. Please check the console for details.');
      } finally {
        container.classList.remove('loading');
        submitBtn.innerHTML = 'üìã Get Requirements';
      }
    });
  </script>

  <script src="../../theme.js"></script>
</body>

</html>